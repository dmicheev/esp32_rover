# OTA Update (Over-The-Air)

–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏ —á–µ—Ä–µ–∑ WiFi –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ USB.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–æ–±–æ—Ç–∞: `http://<IP-–∞–¥—Ä–µ—Å>:8080/`
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **üîÑ OTA Update** –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
3. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ `.bin` —Ñ–∞–π–ª –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ –∫–Ω–æ–ø–∫–æ–π "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª"
4. –ù–∞–∂–º–∏—Ç–µ **–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É**
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

### 2. –ß–µ—Ä–µ–∑ API

```bash
curl -X POST -F "firmware=@.pio/build/esp32-s3-devkitc1-n16r8/firmware.bin" http://<IP-–∞–¥—Ä–µ—Å>:8080/api/ota/upload
```

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/ota` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—à–∏–≤–∫–∏ (UI) |
| POST | `/api/ota/upload` | –ó–∞–≥—Ä—É–∑–∫–∞ .bin —Ñ–∞–π–ª–∞ |

## –ü–æ–ª—É—á–µ–Ω–∏–µ .bin —Ñ–∞–π–ª–∞

### PlatformIO

```bash
# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—à–∏–≤–∫—É
pio run

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –¢–û–õ–¨–ö–û –≠–¢–û–¢ –§–ê–ô–õ):
# .pio/build/esp32-s3-devkitc1-n16r8/firmware.bin
```

‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —Å–∫—Ä–∏–ø—Ç `create_ota_bin.sh` - –æ–Ω —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å bootloader –∏ partition table, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É Update.h.

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –î–ª—è OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `firmware.bin`. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å bootloader –∏ partition table - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Update.h –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—à–∏–≤–∫—É –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª OTA.

### Arduino IDE

1. **Sketch ‚Üí Export Compiled Binary**
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `<–∏–º—è_–ø—Ä–æ–µ–∫—Ç–∞>.firmware.bin` (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `.bin` –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞)
3. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª—ã —Å `bootloader` –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ESP32-S3 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–π –∂–µ WiFi —Å–µ—Ç–∏
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ flash –ø–∞–º—è—Ç–∏
- –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.bin`

## –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `Not enough space` | –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π | –û—á–∏—Å—Ç–∏—Ç–µ –ø–∞–º—è—Ç—å –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ |
| `Update.begin() failed` | –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–∞–∑–¥–µ–ª–æ–≤ |
| `Update.end() failed` | –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π bin —Ñ–∞–π–ª | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `firmware.bin`, –Ω–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª |
| `No OTA partition` | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª –¥–ª—è OTA | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ platformio.ini |
| `Upload failed` | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ `firmware.bin` |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ—à–∏–≤–∫–∏. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤ —Ç–æ–π –∂–µ WiFi —Å–µ—Ç–∏ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—É—é –ø—Ä–æ—à–∏–≤–∫—É.

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
- –ü—Ä–æ–≤–µ—Ä–∫—É —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏
- HTTPS –≤–º–µ—Å—Ç–æ HTTP
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
